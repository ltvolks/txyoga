[tox]
envlist = py26,py27

[testenv]
deps =
    coverage
    sphinx
    twisted
commands =
    coverage run \
        --source=txyoga --branch --omit txyoga/interface.py \
        {envdir}/bin/trial --temp-directory={envdir}/.trial txyoga
    coverage report \
        --omit txyoga/interface.py --show-missing
    coverage html \
        --omit txyoga/interface.py --directory {envdir}/coverage_html

    twistd --pidfile {envdir}/tutorial.pid --logfile {envdir}/tutorial.log \
        web --path={toxinidir}/docs/tutorial
    sphinx-build -b doctest docs {envdir}/built_docs/html
    python -c 'import os, signal; \
               pidfile = {envdir} + "/tutorial.pid"; \
               pid = int(open(pidfile).read()); \
               os.kill(pid, signal.SIGTERM); \
               os.unlink(pidfile)'

    sphinx-build -b html docs {envdir}/built_docs/html
setenv =
    PYTHONPATH = docs
